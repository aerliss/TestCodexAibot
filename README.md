# AI Telegram-бот для генерации медиа

## Состав проекта
- `bot` — Telegram-бот на **aiogram 3.x**.
- `worker` — асинхронная обработка задач из Redis-очереди.
- `webapp` — личный кабинет и админ-страница на **FastAPI**.
- `common` — общие модули конфигурации, БД, безопасности и хранилища.
- Инфраструктура в Docker Compose: `postgres`, `redis`, `minio`, `bot`, `worker`, `webapp`.

## Что исправлено по замечаниям
1. **Идемпотентность платежей**: повторные обновления `successful_payment` больше не начисляют кредиты повторно.
2. **Доступ в кабинет из кнопки**: кнопка «Личный кабинет» передаёт подписанный `auth`-токен, поэтому пользователь открывает кабинет без ошибки 401.

## Быстрый старт
```bash
cp .env.example .env
```

Заполните в `.env` обязательные параметры:
- `BOT_TOKEN`
- `BOT_USERNAME`
- `GEMINI_API_KEY`
- `WEBAPP_SECRET`

Запуск сервисов:
```bash
docker compose up -d --build
```

Инициализация таблиц:
```bash
docker compose exec bot python scripts/init_db.py
```

## Масштабирование воркеров
```bash
docker compose up -d --scale worker=5
```

## Примечание
Все пользовательские сообщения, комментарии и описание проекта в этом репозитории ведутся на русском языке.
